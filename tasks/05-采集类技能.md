# ä»»åŠ¡ 05ï¼šé‡‡é›†ç±»æŠ€èƒ½å®ç°

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
å®ç°é‡‡é›†ç±»æŠ€èƒ½çš„å®Œæ•´æ‰§è¡Œé€»è¾‘ï¼ŒåŒ…æ‹¬ä¼æœ¨ã€é‡‡çŸ¿ã€é’“é±¼ã€é‡‡é›†ã€å…»æ®–ã€‚

## ğŸ“ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
```
backend/internal/service/
â”œâ”€â”€ gathering.go        # é‡‡é›†æŠ€èƒ½æœåŠ¡
â””â”€â”€ skill_executor.go   # æŠ€èƒ½æ‰§è¡Œå™¨

backend/internal/handler/
â””â”€â”€ gathering.go        # é‡‡é›†æŠ€èƒ½æ¥å£

backend/internal/data/
â””â”€â”€ gathering_modules.go # é‡‡é›†å­æ¨¡å—åˆå§‹åŒ–æ•°æ®
```

## ğŸ“ è¯¦ç»†å®ç°è¦æ±‚

### 1. é‡‡é›†å­æ¨¡å—æ•°æ®
```go
// ä¼æœ¨å­æ¨¡å—
var WoodcuttingModules = []SkillModule{
    {Code: "chop_oak", Name: "ç ä¼æ©¡æ ‘", RequiredLevel: 1, ExecutionTime: 5, ExpReward: 10,
     OutputConfig: `[{"item_code": "oak_log", "quantity": 1, "chance": 1.0}]`},
    {Code: "chop_willow", Name: "ç ä¼æŸ³æ ‘", RequiredLevel: 10, ExecutionTime: 6, ExpReward: 15,
     OutputConfig: `[{"item_code": "willow_log", "quantity": 1, "chance": 1.0}]`},
    {Code: "chop_maple", Name: "ç ä¼æ«æ ‘", RequiredLevel: 20, ExecutionTime: 8, ExpReward: 25,
     OutputConfig: `[{"item_code": "maple_log", "quantity": 1, "chance": 1.0}]`},
}

// é‡‡çŸ¿å­æ¨¡å—
var MiningModules = []SkillModule{
    {Code: "mine_copper", Name: "å¼€é‡‡é“œçŸ¿", RequiredLevel: 1, ExecutionTime: 5, ExpReward: 10,
     OutputConfig: `[{"item_code": "copper_ore", "quantity": 1, "chance": 1.0}]`},
    {Code: "mine_iron", Name: "å¼€é‡‡é“çŸ¿", RequiredLevel: 15, ExecutionTime: 7, ExpReward: 20,
     OutputConfig: `[{"item_code": "iron_ore", "quantity": 1, "chance": 1.0}]`},
    {Code: "mine_gold", Name: "å¼€é‡‡é‡‘çŸ¿", RequiredLevel: 30, ExecutionTime: 10, ExpReward: 35,
     OutputConfig: `[{"item_code": "gold_ore", "quantity": 1, "chance": 1.0}]`},
}

// é’“é±¼å­æ¨¡å—
var FishingModules = []SkillModule{
    {Code: "fish_shrimp", Name: "æ•æå°è™¾", RequiredLevel: 1, ExecutionTime: 4, ExpReward: 8,
     OutputConfig: `[{"item_code": "shrimp", "quantity": 1, "chance": 1.0}]`},
    {Code: "fish_trout", Name: "æ•æé³Ÿé±¼", RequiredLevel: 10, ExecutionTime: 6, ExpReward: 15,
     OutputConfig: `[{"item_code": "trout", "quantity": 1, "chance": 1.0}]`},
    {Code: "fish_salmon", Name: "æ•æä¸‰æ–‡é±¼", RequiredLevel: 25, ExecutionTime: 8, ExpReward: 28,
     OutputConfig: `[{"item_code": "salmon", "quantity": 1, "chance": 1.0}]`},
}

// é‡‡é›†å­æ¨¡å—
var GatheringModules = []SkillModule{
    {Code: "gather_herb", Name: "é‡‡é›†è‰è¯", RequiredLevel: 1, ExecutionTime: 4, ExpReward: 8,
     OutputConfig: `[{"item_code": "herb", "quantity": 1, "chance": 1.0}]`},
    {Code: "gather_berry", Name: "é‡‡é›†æµ†æœ", RequiredLevel: 5, ExecutionTime: 3, ExpReward: 10,
     OutputConfig: `[{"item_code": "berry", "quantity": 2, "chance": 1.0}]`},
    {Code: "gather_flax", Name: "é‡‡é›†äºšéº»", RequiredLevel: 15, ExecutionTime: 5, ExpReward: 18,
     OutputConfig: `[{"item_code": "flax", "quantity": 1, "chance": 1.0}]`},
}

// å…»æ®–å­æ¨¡å—
var FarmingModules = []SkillModule{
    {Code: "farm_chicken", Name: "é¥²å…»é¸¡", RequiredLevel: 1, ExecutionTime: 30, ExpReward: 20,
     OutputConfig: `[{"item_code": "egg", "quantity": 1, "chance": 1.0}, {"item_code": "feather", "quantity": 1, "chance": 0.5}]`},
    {Code: "farm_sheep", Name: "é¥²å…»ç¾Š", RequiredLevel: 10, ExecutionTime: 60, ExpReward: 40,
     OutputConfig: `[{"item_code": "wool", "quantity": 2, "chance": 1.0}]`},
    {Code: "farm_cow", Name: "é¥²å…»ç‰›", RequiredLevel: 20, ExecutionTime: 90, ExpReward: 60,
     OutputConfig: `[{"item_code": "leather", "quantity": 1, "chance": 1.0}, {"item_code": "milk", "quantity": 1, "chance": 1.0}]`},
}
```

### 2. æŠ€èƒ½æ‰§è¡ŒæœåŠ¡ (GatheringService)
```go
type GatheringService struct {
    db *gorm.DB
}

// ExecuteModule æ‰§è¡Œé‡‡é›†å­æ¨¡å—
func (s *GatheringService) ExecuteModule(characterID uint, moduleCode string) (*ExecutionResult, error) {
    // 1. è·å–è§’è‰²å’Œå­æ¨¡å—ä¿¡æ¯
    // 2. æ£€æŸ¥æŠ€èƒ½ç­‰çº§æ˜¯å¦æ»¡è¶³è¦æ±‚
    // 3. è®¡ç®—æ‰§è¡Œæ—¶é—´
    // 4. è¿”å›æ‰§è¡Œä»»åŠ¡IDï¼ˆä¾›ä»»åŠ¡é˜Ÿåˆ—ä½¿ç”¨ï¼‰
}

// CompleteExecution å®Œæˆæ‰§è¡Œï¼ˆæ—¶é—´åˆ°åè°ƒç”¨ï¼‰
func (s *GatheringService) CompleteExecution(executionID uint) (*CompletionResult, error) {
    // 1. æ ¹æ®äº§å‡ºé…ç½®ç”Ÿæˆç‰©å“
    // 2. åº”ç”¨å¹¸è¿åŒå€äº§å‡ºï¼ˆæ£€æŸ¥è§’è‰²å¹¸è¿å±æ€§ï¼‰
    // 3. æ·»åŠ ç‰©å“åˆ°ä»“åº“
    // 4. å¢åŠ æŠ€èƒ½ç»éªŒ
    // 5. æ£€æŸ¥å‡çº§
}
```

### 3. å¹¸è¿åŒå€äº§å‡ºé€»è¾‘
```go
func (s *GatheringService) applyLuckBonus(character *Character, outputs []ItemOutput) []ItemOutput {
    // å¹¸è¿å€¼ / 1000 = åŒå€æ¦‚ç‡
    // ä¾‹å¦‚ï¼šå¹¸è¿100 = 10%æ¦‚ç‡åŒå€
    luckChance := float64(character.Luck) / 1000.0
    
    for i := range outputs {
        if rand.Float64() < luckChance {
            outputs[i].Quantity *= 2
            outputs[i].IsDoubled = true
        }
    }
    return outputs
}
```

### 4. API æ¥å£
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/characters/:id/skills/execute | å¼€å§‹æ‰§è¡ŒæŠ€èƒ½å­æ¨¡å— |
| GET | /api/characters/:id/skills/current | è·å–å½“å‰æ‰§è¡Œä¸­çš„ä»»åŠ¡ |

### 5. æ‰§è¡Œè§„åˆ™
- ç”Ÿæ´»æŠ€èƒ½ï¼ˆé‡‡é›†ç±»+åˆæˆç±»ï¼‰äº’æ–¥ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ª
- æ‰§è¡Œä¸­ä¸å¯å–æ¶ˆ
- æ‰§è¡Œå®Œæˆåè‡ªåŠ¨æ·»åŠ ç‰©å“åˆ°ä»“åº“

## âœ… éªŒè¯æ£€æŸ¥ç‚¹

å®Œæˆåè¯·éªŒè¯ï¼š
1. [ ] èƒ½è·å–æ‰€æœ‰é‡‡é›†å­æ¨¡å—åˆ—è¡¨
2. [ ] ç­‰çº§ä¸è¶³æ—¶æ‰§è¡Œè¿”å›é”™è¯¯
3. [ ] æ‰§è¡Œå¼€å§‹åè¿”å›é¢„è®¡å®Œæˆæ—¶é—´
4. [ ] æ‰§è¡Œå®Œæˆåç‰©å“æ­£ç¡®æ·»åŠ åˆ°ä»“åº“
5. [ ] æŠ€èƒ½ç»éªŒæ­£ç¡®å¢åŠ 
6. [ ] å¹¸è¿åŒå€äº§å‡ºé€»è¾‘æ­£ç¡®
7. [ ] åŒæ—¶æ‰§è¡Œå¤šä¸ªç”Ÿæ´»æŠ€èƒ½è¢«é˜»æ­¢

## ğŸ”— ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡ 02ï¼ˆç‰©å“ç³»ç»Ÿï¼‰
- ä¾èµ–ï¼šä»»åŠ¡ 04ï¼ˆæŠ€èƒ½æ¡†æ¶ï¼‰
