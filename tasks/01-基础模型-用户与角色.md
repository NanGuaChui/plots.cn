# ä»»åŠ¡ 01ï¼šåŸºç¡€æ¨¡å‹ - ç”¨æˆ·ä¸è§’è‰²ç³»ç»Ÿ

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
å»ºç«‹æ¸¸æˆçš„ç”¨æˆ·è´¦å·å’Œè§’è‰²åŸºç¡€æ•°æ®æ¨¡å‹ï¼Œå®ç°è´¦å·æ³¨å†Œç™»å½•å’Œè§’è‰²åˆ›å»ºåŠŸèƒ½ã€‚

## ğŸ“ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
```
backend/internal/model/
â”œâ”€â”€ user.go          # ç”¨æˆ·è´¦å·æ¨¡å‹
â”œâ”€â”€ character.go     # è§’è‰²æ¨¡å‹
â””â”€â”€ migrate.go       # æ•°æ®åº“è¿ç§»
```

### API è·¯ç”±
```
backend/internal/handler/
â”œâ”€â”€ auth.go          # æ³¨å†Œ/ç™»å½•æ¥å£
â””â”€â”€ character.go     # è§’è‰² CRUD æ¥å£
```

## ğŸ“ è¯¦ç»†å®ç°è¦æ±‚

### 1. ç”¨æˆ·æ¨¡å‹ (User)
```go
type User struct {
    ID        uint      `gorm:"primaryKey"`
    Username  string    `gorm:"size:50;uniqueIndex"`  // ç™»å½•ç”¨æˆ·å
    Password  string    `gorm:"size:100"`             // åŠ å¯†åçš„å¯†ç 
    CreatedAt time.Time
    UpdatedAt time.Time
}
```

### 2. è§’è‰²æ¨¡å‹ (Character)
```go
type CharacterType string

const (
    CharacterTypeMain    CharacterType = "main"      // ä¸»å·
    CharacterTypeIronman CharacterType = "ironman"   // é“äººå·
)

type Character struct {
    ID            uint          `gorm:"primaryKey"`
    UserID        uint          `gorm:"index"`           // æ‰€å±ç”¨æˆ·
    Name          string        `gorm:"size:50"`         // è§’è‰²å
    SlotIndex     int           `gorm:""`                // æ§½ä½ç´¢å¼• 0-3
    Type          CharacterType `gorm:"size:20"`         // ä¸»å·/é“äººå·
    
    // åŸºç¡€å±æ€§ï¼ˆ5é¡¹ï¼‰
    Strength      int           `gorm:"default:10"`      // åŠ›é‡ - ç‰©ç†æ”»å‡»ã€ç‰©ç†æŠ€èƒ½ä¼¤å®³
    Agility       int           `gorm:"default:10"`      // æ•æ· - é€Ÿåº¦ã€é—ªé¿ç‡
    Endurance     int           `gorm:"default:10"`      // è€åŠ› - ç”Ÿå‘½å€¼ã€ç‰©ç†é˜²å¾¡
    Intelligence  int           `gorm:"default:10"`      // æ™ºåŠ› - é­”æ³•æ”»å‡»ã€é­”æ³•é˜²å¾¡ã€è“é‡
    Luck          int           `gorm:"default:10"`      // å¹¸è¿ - æš´å‡»ç‡ã€æš´å‡»ä¼¤å®³ã€æˆ˜åˆ©å“æ‰è½
    
    // æˆ˜æ–—ç­‰çº§
    CombatLevel   int           `gorm:"default:1"`       // æˆ˜æ–—ç­‰çº§
    CombatExp     int           `gorm:"default:0"`       // æˆ˜æ–—ç»éªŒ
    
    CreatedAt     time.Time
    UpdatedAt     time.Time
}
```

### 3. è¡ç”Ÿå±æ€§è®¡ç®—å…¬å¼
```go
// DerivedStats è¡ç”Ÿå±æ€§ï¼ˆç”±åŸºç¡€å±æ€§è®¡ç®—å¾—å‡ºï¼‰
type DerivedStats struct {
    // æ”»å‡»å±æ€§
    PhysicalAttack int     // ç‰©ç†æ”»å‡» = åŠ›é‡ * 2 + è£…å¤‡åŠ æˆ
    MagicAttack    int     // é­”æ³•æ”»å‡» = æ™ºåŠ› * 2 + è£…å¤‡åŠ æˆ
    
    // é˜²å¾¡å±æ€§
    PhysicalDefense int    // ç‰©ç†é˜²å¾¡ = è€åŠ› * 1.5 + è£…å¤‡åŠ æˆ
    MagicDefense    int    // é­”æ³•é˜²å¾¡ = æ™ºåŠ› * 1 + è£…å¤‡åŠ æˆ
    
    // ç”Ÿå‘½è“é‡
    MaxHP          int     // æœ€å¤§ç”Ÿå‘½ = 100 + è€åŠ› * 10 + è£…å¤‡åŠ æˆ
    MaxMP          int     // æœ€å¤§è“é‡ = 50 + æ™ºåŠ› * 5 + è£…å¤‡åŠ æˆ
    
    // æˆ˜æ–—å±æ€§
    Speed          int     // é€Ÿåº¦ = æ•æ· * 1 + è£…å¤‡åŠ æˆ
    DodgeRate      float64 // é—ªé¿ç‡ = æ•æ· * 0.05% + è£…å¤‡åŠ æˆ
    CritRate       float64 // æš´å‡»ç‡ = å¹¸è¿ * 0.1% + è£…å¤‡åŠ æˆ
    CritDamage     float64 // æš´å‡»ä¼¤å®³ = 150% + å¹¸è¿ * 0.5% + è£…å¤‡åŠ æˆ
    
    // æ‰è½å±æ€§
    LootDropRate   float64 // æˆ˜åˆ©å“æ‰è½ç‡ = å¹¸è¿ * 0.1% + è£…å¤‡åŠ æˆ
}

// CalculateDerivedStats è®¡ç®—è¡ç”Ÿå±æ€§
func CalculateDerivedStats(char *Character, equipBonus *EquipmentBonus) DerivedStats {
    return DerivedStats{
        PhysicalAttack:  char.Strength*2 + equipBonus.PhysicalAttack,
        MagicAttack:     char.Intelligence*2 + equipBonus.MagicAttack,
        PhysicalDefense: int(float64(char.Endurance)*1.5) + equipBonus.PhysicalDefense,
        MagicDefense:    char.Intelligence + equipBonus.MagicDefense,
        MaxHP:           100 + char.Endurance*10 + equipBonus.MaxHP,
        MaxMP:           50 + char.Intelligence*5 + equipBonus.MaxMP,
        Speed:           char.Agility + equipBonus.Speed,
        DodgeRate:       float64(char.Agility)*0.0005 + equipBonus.DodgeRate,
        CritRate:        float64(char.Luck)*0.001 + equipBonus.CritRate,
        CritDamage:      1.5 + float64(char.Luck)*0.005 + equipBonus.CritDamage,
        LootDropRate:    float64(char.Luck)*0.001 + equipBonus.LootDropRate,
    }
}
```

### 3. ä¸šåŠ¡è§„åˆ™
- æ¯ä¸ªç”¨æˆ·æœ€å¤šåˆ›å»º 4 ä¸ªè§’è‰²
- æ§½ä½ 0 å¿…é¡»æ˜¯ä¸»å· (main)ï¼Œæ§½ä½ 1-3 å¿…é¡»æ˜¯é“äººå· (ironman)
- ä¸»å·å¯å‚ä¸å¸‚åœºäº¤æ˜“ï¼ˆåç»­å®ç°ï¼‰
- é“äººå·å®Œå…¨è‡ªç»™è‡ªè¶³ï¼Œæ— æ³•äº¤æ˜“

### 4. API æ¥å£
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/auth/register | ç”¨æˆ·æ³¨å†Œ |
| POST | /api/auth/login | ç”¨æˆ·ç™»å½• |
| GET | /api/characters | è·å–å½“å‰ç”¨æˆ·æ‰€æœ‰è§’è‰² |
| POST | /api/characters | åˆ›å»ºæ–°è§’è‰² |
| GET | /api/characters/:id | è·å–è§’è‰²è¯¦æƒ… |
| DELETE | /api/characters/:id | åˆ é™¤è§’è‰² |

## âœ… éªŒè¯æ£€æŸ¥ç‚¹

å®Œæˆåè¯·éªŒè¯ï¼š
1. [ ] èƒ½æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·
2. [ ] èƒ½æˆåŠŸç™»å½•å¹¶è·å– JWT Token
3. [ ] èƒ½åˆ›å»ºè§’è‰²ï¼ˆéªŒè¯æ§½ä½é™åˆ¶ï¼šæœ€å¤š4ä¸ªï¼‰
4. [ ] æ§½ä½0è‡ªåŠ¨è®¾ä¸ºä¸»å·ï¼Œå…¶ä»–ä¸ºé“äººå·
5. [ ] èƒ½è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²åˆ—è¡¨
6. [ ] è§’è‰²çš„åŸºç¡€å±æ€§æ­£ç¡®åˆå§‹åŒ–

## ğŸ”— ä¾èµ–å…³ç³»
- æ— å‰ç½®ä¾èµ–ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡
