## 📖 游戏框架完整需求文档（最终版）

---

### 一、技术栈

| 层级 | 技术 |
|------|------|
| 前端框架 | Vue3 + Vite |
| 状态管理 | Pinia |
| UI组件库 | Element Plus |
| 后端框架 | Go + Gin |
| ORM | GORM |
| 数据库 | SQLite |
| 实时通讯 | WebSocket |
| 身份认证 | golang-jwt |

---

### 二、账号与角色系统

**账号结构：**
- 每个用户账号拥有4个角色槽位
- 主号（1个）：可参与市场交易
- 铁人号（3个）：完全自给自足，无法交易

**角色基础属性：**

| 属性 | 作用 |
|------|------|
| 力量 | 物理伤害、部分技能伤害计算 |
| 敏捷 | 行动顺序（速度）、暴击率、部分技能伤害计算 |
| 耐力 | 血量、防御 |
| 智力 | 魔法伤害、蓝量、部分技能伤害计算 |
| 幸运 | 双倍产出概率、战利品掉落加成等多场景 |
| 战利品掉落率 | 仅影响战利品掉落概率 |

**战斗衍生属性：**
- 攻击力、防御力、血量(HP)、蓝量(MP)、速度、暴击率、暴击伤害

**等级系统：**
- 战斗等级：战斗相关成长
- 生活技能等级：用于解锁子模块
- 无属性点自由分配
- 智力经验：每使用一个技能+1经验

---

### 三、生活技能系统

**技能分类：**

| 类型 | 技能 | 说明 |
|------|------|------|
| 采集类 | 伐木 | 砍伐树木获取木材 |
| 采集类 | 采矿 | 开采矿石 |
| 采集类 | 钓鱼 | 捕获鱼类 |
| 采集类 | 采集 | 采集浆果、草药等 |
| 采集类 | 养殖 | 饲养动物获取产出（等待几秒→收获） |
| 合成类 | 烹饪 | 使用配方制作食物 |
| 合成类 | 锻造 | 使用配方制作武器、工具、盔甲 |
| 合成类 | 缝制 | 使用配方制作布甲、帽子、背包 |
| 战斗类 | 战斗 | 与怪物战斗，获取战利品 |
| 特殊类 | 强化 | 消耗材料强化装备 |

**技能子模块：**
- 每个技能下有多个子模块
- 不同子模块有不同的等级要求、执行时间、产出内容
- 生活技能等级用于解锁子模块

**执行规则：**
- 生活技能（采集类+合成类）互斥，同一时间只能执行一个
- 战斗和强化可与生活技能同时进行

**技能依赖关系：**
- 各技能之间通过物品形成依赖
- 示例：养殖(羊)→羊毛→缝制(羊毛帽)

**幸运效果：**
- 采集类技能有幸运%概率双倍产出

---

### 四、任务队列系统

- 最大长度：10个任务
- 格式：技能 - 子模块 - 执行次数
- 功能：添加、删除、调整顺序
- 展示：主页单独显示队列
- 执行：按顺序执行，当前任务完成后自动执行下一个
- 养殖也在任务队列中

---

### 五、物品系统

**标签体系：**
- 采用多标签设计，一个物品可同时拥有多个标签
- 标签示例：材料、晶体、战利品、一级、二级、鱼类、消耗品、装备等

**产出来源：**
- 同一物品可从多个途径获得

**其他属性：**
- 是否可堆叠、最大堆叠数、等级(tier)
- 强化相关：消耗材料、每级失败率、强化上限

---

### 六、配方/合成系统

- 合成类技能（烹饪、锻造、缝制）使用配方制作物品
- 配方定义：所需材料列表 → 产出物品
- 制作条件：所需技能等级、材料是否充足
- 制作过程：消耗材料、花费时间、获得产出和经验

---

### 七、装备系统

**基础属性加成：**
- 力量、敏捷、耐力、智力、幸运、战利品掉落率

**特殊效果：**
- 触发时机：战斗开始、回合开始、行动时、受击时、回合结束、死亡时、复活时
- 示例：回合开始给自己上Buff、受击时反伤

---

### 八、强化系统

- 消耗材料：每个物品不同，定义在物品属性中
- 失败率：每级不同
- 强化上限：每个物品不同
- 失败结果：
  - 无保护 → 掉到未强化
  - 有保护 → 只掉1级

---

### 九、仓库系统

- 每个角色拥有独立仓库
- 主号与铁人号仓库完全独立

---

### 十、战斗系统

**战斗界面Tab：**

| Tab | 说明 |
|-----|------|
| 战斗区域 | 选择战斗地点 |
| 房间列表 | 查看/加入房间 |
| 当前房间 | 当前战斗状态（无房间时置灰） |

**房间系统：**
- 支持1-3人
- 创建房间后在列表中公开，他人自行加入
- 可配置：战斗区域、是否自动重开
- 每人独立掉落
- 离线后战斗继续

**离线/离开处理：**
- 当前波次：离开的玩家仍然参与
- 下一波：直接移除离开的玩家

**战斗快照机制：**
- 战斗开始时：玩家属性和技能配置固定为快照
- 战斗中换装/改配置不影响当前战斗
- 只有结束/重启战斗才会更新配置

**战斗模式：**
- 回合制，无限波数
- 直到主动退出或全员死亡
- 全员死亡后判断是否自动重开

**回合阶段：**
1. 备战阶段：装备效果触发、被动技能触发、状态效果结算
2. 行动阶段：按敏捷排序依次行动，执行主动/被动技能
3. 结算阶段：回合结束效果触发、判断胜负

**敌人系统：**
- 每个区域有预制敌人列表和出现权重
- 每波根据权重随机生成固定数量敌人
- Boss/精英怪固定每X回合出现一次
- 敌人有血量、蓝量、防御、技能（有AI条件）

**死亡与复活：**
- 有复活技能（从怪物掉落技能书学习）
- 角色死亡后队友可使用复活技能
- 全员死亡则退出波次

---

### 十一、战斗技能系统

**技能来源：**
- 初始只有「普通攻击」（不可成长）
- 通过使用「技能书」学习新技能（从敌人掉落获得）

**技能分类：**

| 维度 | 分类 |
|------|------|
| 按效果 | 伤害、治疗、Buff、Debuff/控制、复活 |
| 按范围 | 单体、群体 |
| 按触发 | 主动、被动（如反伤） |

**技能属性：**
- CD（冷却回合数）
- 蓝量消耗
- 伤害计算基于：智力/力量/敏捷（每个技能不同）

**技能成长：**
- 每使用一次技能获得1点经验
- 经验累计可升级

**技能目标选择：**
- 默认：按敌方顺序
- 特殊技能可配置：随机打击 / 固定命中血量最少的敌方

**技能配置（角色菜单）：**
- 启用/停用开关
- 释放条件配置
- 拖拽排序决定优先级
- 无数量限制

**释放条件配置：**
- 目标选择：自己/敌方
- 判断类型：状态判断、数量判断、存在判断
- 状态判断：全部包含/存在包含/全部不包含/存在不包含 + 状态（灼伤/冰冻/眩晕/阵亡/存活等）
- 数量判断：敌人数量大于/小于X
- 存在判断：是否包含Boss/精英怪

**敌人AI：**
- 敌人也有技能和释放条件配置

**Buff/Debuff叠加规则：**
- 部分：刷新持续时间
- 部分：叠加层数
- 在Buff定义中指定叠加类型

---

### 十二、市场交易系统

- 主号可交易
- 当前版本暂不实现，后续版本加入

---

### 十三、界面风格

- 整体布局：类似后台管理系统
- 左侧菜单：导航各技能模块
- 主内容区：展示技能操作、进度、配方等
- 主页：单独显示任务队列

---

### 十四、数据初始化

- 所有基础配置数据通过代码预设，服务启动时自动初始化

---

### 将添加的内容概要：

**十五、数据存储架构**
1. **数据库表设计**
   - `items` 表：物品基础信息
   - `item_recipes` 表：合成配方定义
   - `item_enhancement` 表：强化配置
   - `item_drops` 表：物品掉落来源

2. **缓存机制**
   - 后端：服务启动时加载配置到内存
   - 前端：通过 Pinia 缓存配置数据

3. **数据流设计**
   - 配置数据初始化流程
   - API 获取配置接口设计

4. **验证策略**
   - 所有关键操作（强化、合成等）在后端验证

---