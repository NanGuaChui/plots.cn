# ä»»åŠ¡ 06ï¼šåˆæˆé…æ–¹ç³»ç»Ÿ

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
å®ç°åˆæˆç±»æŠ€èƒ½ï¼ˆçƒ¹é¥ªã€é”»é€ ã€ç¼åˆ¶ï¼‰çš„é…æ–¹ç³»ç»Ÿå’Œåˆ¶ä½œé€»è¾‘ã€‚

## ğŸ“ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
```
backend/internal/model/
â””â”€â”€ recipe.go           # é…æ–¹æ¨¡å‹ï¼ˆå¦‚éœ€å•ç‹¬ï¼‰

backend/internal/service/
â””â”€â”€ crafting.go         # åˆæˆæŠ€èƒ½æœåŠ¡

backend/internal/handler/
â””â”€â”€ crafting.go         # åˆæˆæŠ€èƒ½æ¥å£

backend/internal/data/
â””â”€â”€ crafting_modules.go # åˆæˆå­æ¨¡å—åˆå§‹åŒ–æ•°æ®
```

## ğŸ“ è¯¦ç»†å®ç°è¦æ±‚

### 1. åˆæˆå­æ¨¡å—æ•°æ®ï¼ˆå«é…æ–¹ï¼‰
```go
// çƒ¹é¥ªå­æ¨¡å—
var CookingModules = []SkillModule{
    {
        Code: "cook_shrimp", Name: "çƒ¹é¥ªå°è™¾", RequiredLevel: 1, 
        ExecutionTime: 3, ExpReward: 12,
        InputConfig:  `[{"item_code": "shrimp", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "cooked_shrimp", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "cook_trout", Name: "çƒ¹é¥ªé³Ÿé±¼", RequiredLevel: 10, 
        ExecutionTime: 4, ExpReward: 20,
        InputConfig:  `[{"item_code": "trout", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "cooked_trout", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "make_berry_pie", Name: "åˆ¶ä½œæµ†æœæ´¾", RequiredLevel: 15, 
        ExecutionTime: 8, ExpReward: 35,
        InputConfig:  `[{"item_code": "berry", "quantity": 5}, {"item_code": "flour", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "berry_pie", "quantity": 1, "chance": 1.0}]`,
    },
}

// é”»é€ å­æ¨¡å—
var SmithingModules = []SkillModule{
    {
        Code: "smith_copper_bar", Name: "ç†”ç‚¼é“œé”­", RequiredLevel: 1, 
        ExecutionTime: 5, ExpReward: 15,
        InputConfig:  `[{"item_code": "copper_ore", "quantity": 2}]`,
        OutputConfig: `[{"item_code": "copper_bar", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "smith_iron_bar", Name: "ç†”ç‚¼é“é”­", RequiredLevel: 15, 
        ExecutionTime: 7, ExpReward: 25,
        InputConfig:  `[{"item_code": "iron_ore", "quantity": 2}]`,
        OutputConfig: `[{"item_code": "iron_bar", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "smith_bronze_sword", Name: "é”»é€ é’é“œå‰‘", RequiredLevel: 5, 
        ExecutionTime: 10, ExpReward: 30,
        InputConfig:  `[{"item_code": "copper_bar", "quantity": 2}, {"item_code": "oak_log", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "bronze_sword", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "smith_iron_sword", Name: "é”»é€ é“å‰‘", RequiredLevel: 20, 
        ExecutionTime: 15, ExpReward: 50,
        InputConfig:  `[{"item_code": "iron_bar", "quantity": 3}, {"item_code": "oak_log", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "iron_sword", "quantity": 1, "chance": 1.0}]`,
    },
}

// ç¼åˆ¶å­æ¨¡å—
var TailoringModules = []SkillModule{
    {
        Code: "make_thread", Name: "åˆ¶ä½œçº¿", RequiredLevel: 1, 
        ExecutionTime: 3, ExpReward: 8,
        InputConfig:  `[{"item_code": "flax", "quantity": 1}]`,
        OutputConfig: `[{"item_code": "thread", "quantity": 2, "chance": 1.0}]`,
    },
    {
        Code: "make_cloth", Name: "ç¼–ç»‡å¸ƒæ–™", RequiredLevel: 5, 
        ExecutionTime: 5, ExpReward: 15,
        InputConfig:  `[{"item_code": "thread", "quantity": 3}]`,
        OutputConfig: `[{"item_code": "cloth", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "make_wool_hat", Name: "ç¼åˆ¶ç¾Šæ¯›å¸½", RequiredLevel: 10, 
        ExecutionTime: 8, ExpReward: 25,
        InputConfig:  `[{"item_code": "wool", "quantity": 3}]`,
        OutputConfig: `[{"item_code": "wool_hat", "quantity": 1, "chance": 1.0}]`,
    },
    {
        Code: "make_leather_armor", Name: "ç¼åˆ¶çš®ç”²", RequiredLevel: 20, 
        ExecutionTime: 15, ExpReward: 50,
        InputConfig:  `[{"item_code": "leather", "quantity": 5}, {"item_code": "thread", "quantity": 3}]`,
        OutputConfig: `[{"item_code": "leather_armor", "quantity": 1, "chance": 1.0}]`,
    },
}
```

### 2. åˆæˆæœåŠ¡ (CraftingService)
```go
type CraftingService struct {
    db *gorm.DB
}

// CheckMaterials æ£€æŸ¥ææ–™æ˜¯å¦å……è¶³
func (s *CraftingService) CheckMaterials(characterID uint, inputs []ItemInput) (bool, []ItemShortage, error) {
    // æ£€æŸ¥ä»“åº“ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„ææ–™
    // è¿”å›ç¼ºå°‘çš„ææ–™åˆ—è¡¨
}

// ExecuteCrafting æ‰§è¡Œåˆæˆ
func (s *CraftingService) ExecuteCrafting(characterID uint, moduleCode string) (*ExecutionResult, error) {
    // 1. è·å–é…æ–¹ä¿¡æ¯
    // 2. æ£€æŸ¥æŠ€èƒ½ç­‰çº§
    // 3. æ£€æŸ¥ææ–™æ˜¯å¦å……è¶³
    // 4. æ¶ˆè€—ææ–™
    // 5. å¼€å§‹æ‰§è¡Œï¼ˆè¿”å›æ‰§è¡ŒIDï¼‰
}

// CompleteCrafting å®Œæˆåˆæˆ
func (s *CraftingService) CompleteCrafting(executionID uint) (*CompletionResult, error) {
    // 1. ç”Ÿæˆäº§å‡ºç‰©å“
    // 2. æ·»åŠ åˆ°ä»“åº“
    // 3. å¢åŠ æŠ€èƒ½ç»éªŒ
}
```

### 3. é…æ–¹å¯æ‰§è¡Œæ¬¡æ•°è®¡ç®—
```go
// GetCraftableCount è®¡ç®—å¯åˆ¶ä½œæ¬¡æ•°
func (s *CraftingService) GetCraftableCount(characterID uint, moduleCode string) (int, error) {
    // æ ¹æ®ä»“åº“ç‰©å“æ•°é‡å’Œé…æ–¹éœ€æ±‚ï¼Œè®¡ç®—æœ€å¤šå¯åˆ¶ä½œå¤šå°‘æ¬¡
}
```

### 4. API æ¥å£
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/skills/:code/modules | è·å–åˆæˆæŠ€èƒ½çš„æ‰€æœ‰é…æ–¹ |
| GET | /api/characters/:id/crafting/check/:moduleCode | æ£€æŸ¥ææ–™å¹¶è¿”å›å¯åˆ¶ä½œæ¬¡æ•° |
| POST | /api/characters/:id/crafting/execute | æ‰§è¡Œåˆæˆ |

### 5. å‰ç«¯é…æ–¹ç•Œé¢è¦ç´ 
- æ˜¾ç¤ºé…æ–¹åç§°ã€æ‰€éœ€ææ–™ã€äº§å‡ºç‰©å“
- æ˜¾ç¤ºå½“å‰ææ–™æ•°é‡ vs æ‰€éœ€æ•°é‡
- ææ–™ä¸è¶³æ—¶æ ‡çº¢
- æ˜¾ç¤ºå¯åˆ¶ä½œæ¬¡æ•°
- ä¸€é”®æœ€å¤§æ¬¡æ•°æŒ‰é’®

## âœ… éªŒè¯æ£€æŸ¥ç‚¹

å®Œæˆåè¯·éªŒè¯ï¼š
1. [ ] èƒ½è·å–æ‰€æœ‰åˆæˆé…æ–¹
2. [ ] ææ–™æ£€æŸ¥æ¥å£è¿”å›æ­£ç¡®çš„ç¼ºå°‘ææ–™ä¿¡æ¯
3. [ ] ææ–™ä¸è¶³æ—¶æ‰§è¡Œè¿”å›é”™è¯¯
4. [ ] æ‰§è¡ŒæˆåŠŸåææ–™æ­£ç¡®æ‰£é™¤
5. [ ] äº§å‡ºç‰©å“æ­£ç¡®æ·»åŠ åˆ°ä»“åº“
6. [ ] å¯åˆ¶ä½œæ¬¡æ•°è®¡ç®—æ­£ç¡®
7. [ ] ä¸é‡‡é›†æŠ€èƒ½äº’æ–¥ï¼ˆä¸èƒ½åŒæ—¶æ‰§è¡Œï¼‰

## ğŸ”— ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡ 02ï¼ˆç‰©å“ç³»ç»Ÿï¼‰
- ä¾èµ–ï¼šä»»åŠ¡ 04ï¼ˆæŠ€èƒ½æ¡†æ¶ï¼‰
- ä¾èµ–ï¼šä»»åŠ¡ 05ï¼ˆéƒ¨åˆ†åŸææ–™æ¥è‡ªé‡‡é›†ï¼‰
