# ä»»åŠ¡ 08ï¼šè£…å¤‡ç³»ç»Ÿ

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
å®ç°è£…å¤‡ç³»ç»Ÿï¼ŒåŒ…æ‹¬è£…å¤‡æ§½ä½ã€å±æ€§åŠ æˆã€ç‰¹æ®Šæ•ˆæœã€‚

## ğŸ“ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
```
backend/internal/model/
â”œâ”€â”€ equipment.go        # è£…å¤‡æ§½ä½æ¨¡å‹
â””â”€â”€ equipment_effect.go # è£…å¤‡ç‰¹æ®Šæ•ˆæœæ¨¡å‹

backend/internal/service/
â””â”€â”€ equipment.go        # è£…å¤‡æœåŠ¡

backend/internal/handler/
â””â”€â”€ equipment.go        # è£…å¤‡æ¥å£

backend/internal/data/
â””â”€â”€ equipments_init.go  # è£…å¤‡æ•°æ®åˆå§‹åŒ–
```

## ğŸ“ è¯¦ç»†å®ç°è¦æ±‚

### 1. è£…å¤‡æ§½ä½å®šä¹‰
```go
type EquipmentSlot string

const (
    SlotWeapon    EquipmentSlot = "weapon"     // æ­¦å™¨
    SlotHelmet    EquipmentSlot = "helmet"     // å¤´ç›”
    SlotChest     EquipmentSlot = "chest"      // èƒ¸ç”²
    SlotLegs      EquipmentSlot = "legs"       // æŠ¤è…¿
    SlotBoots     EquipmentSlot = "boots"      // é´å­
    SlotGloves    EquipmentSlot = "gloves"     // æ‰‹å¥—
    SlotNecklace  EquipmentSlot = "necklace"   // é¡¹é“¾
    SlotRing1     EquipmentSlot = "ring1"      // æˆ’æŒ‡1
    SlotRing2     EquipmentSlot = "ring2"      // æˆ’æŒ‡2
    SlotBackpack  EquipmentSlot = "backpack"   // èƒŒåŒ…
)
```

### 2. è§’è‰²è£…å¤‡æ¨¡å‹ (CharacterEquipment)
```go
type CharacterEquipment struct {
    ID            uint          `gorm:"primaryKey"`
    CharacterID   uint          `gorm:"uniqueIndex:idx_char_slot"`
    Slot          EquipmentSlot `gorm:"size:20;uniqueIndex:idx_char_slot"`
    InventoryItemID uint        `gorm:"index"` // å…³è”ä»“åº“ä¸­çš„ç‰©å“
    
    InventoryItem InventoryItem `gorm:"foreignKey:InventoryItemID"`
}
```

### 3. è£…å¤‡å±æ€§é…ç½®ï¼ˆæ‰©å±• Item æ¨¡å‹ï¼‰
```go
// åœ¨ Item æ¨¡å‹ä¸­æ·»åŠ è£…å¤‡å±æ€§
type ItemEquipmentStats struct {
    ID             uint          `gorm:"primaryKey"`
    ItemID         uint          `gorm:"uniqueIndex"`
    Slot           EquipmentSlot `gorm:"size:20"`    // å¯è£…å¤‡æ§½ä½
    
    // åŸºç¡€å±æ€§åŠ æˆï¼ˆå½±å“è¡ç”Ÿå±æ€§è®¡ç®—ï¼‰
    Strength       int           `gorm:"default:0"`  // åŠ›é‡ - å½±å“ç‰©ç†æ”»å‡»
    Agility        int           `gorm:"default:0"`  // æ•æ· - å½±å“é€Ÿåº¦ã€é—ªé¿
    Endurance      int           `gorm:"default:0"`  // è€åŠ› - å½±å“ç”Ÿå‘½ã€ç‰©é˜²
    Intelligence   int           `gorm:"default:0"`  // æ™ºåŠ› - å½±å“é­”æ”»ã€é­”é˜²ã€è“é‡
    Luck           int           `gorm:"default:0"`  // å¹¸è¿ - å½±å“æš´å‡»ã€æ‰è½
    
    // ç›´æ¥å±æ€§åŠ æˆï¼ˆç›´æ¥åŠ åˆ°è¡ç”Ÿå±æ€§ä¸Šï¼‰
    PhysicalAttack  int          `gorm:"default:0"`  // ç‰©ç†æ”»å‡»
    MagicAttack     int          `gorm:"default:0"`  // é­”æ³•æ”»å‡»
    PhysicalDefense int          `gorm:"default:0"`  // ç‰©ç†é˜²å¾¡
    MagicDefense    int          `gorm:"default:0"`  // é­”æ³•é˜²å¾¡
    MaxHP           int          `gorm:"default:0"`  // æœ€å¤§ç”Ÿå‘½
    MaxMP           int          `gorm:"default:0"`  // æœ€å¤§è“é‡
    Speed           int          `gorm:"default:0"`  // é€Ÿåº¦
    DodgeRate       float64      `gorm:"default:0"`  // é—ªé¿ç‡
    CritRate        float64      `gorm:"default:0"`  // æš´å‡»ç‡
    CritDamage      float64      `gorm:"default:0"`  // æš´å‡»ä¼¤å®³
    LootDropRate    float64      `gorm:"default:0"`  // æˆ˜åˆ©å“æ‰è½ç‡
}

// EquipmentBonus è£…å¤‡æ€»åŠ æˆï¼ˆç”¨äºè¡ç”Ÿå±æ€§è®¡ç®—ï¼‰
type EquipmentBonus struct {
    // åŸºç¡€å±æ€§åŠ æˆ
    Strength       int
    Agility        int
    Endurance      int
    Intelligence   int
    Luck           int
    
    // ç›´æ¥å±æ€§åŠ æˆ
    PhysicalAttack  int
    MagicAttack     int
    PhysicalDefense int
    MagicDefense    int
    MaxHP           int
    MaxMP           int
    Speed           int
    DodgeRate       float64
    CritRate        float64
    CritDamage      float64
    LootDropRate    float64
}
```

### 4. è£…å¤‡ç‰¹æ®Šæ•ˆæœæ¨¡å‹
```go
type EffectTrigger string

const (
    TriggerBattleStart  EffectTrigger = "battle_start"   // æˆ˜æ–—å¼€å§‹
    TriggerRoundStart   EffectTrigger = "round_start"    // å›åˆå¼€å§‹
    TriggerOnAction     EffectTrigger = "on_action"      // è¡ŒåŠ¨æ—¶
    TriggerOnHit        EffectTrigger = "on_hit"         // å—å‡»æ—¶
    TriggerRoundEnd     EffectTrigger = "round_end"      // å›åˆç»“æŸ
    TriggerOnDeath      EffectTrigger = "on_death"       // æ­»äº¡æ—¶
    TriggerOnRevive     EffectTrigger = "on_revive"      // å¤æ´»æ—¶
)

type ItemEquipmentEffect struct {
    ID          uint          `gorm:"primaryKey"`
    ItemID      uint          `gorm:"index"`
    Trigger     EffectTrigger `gorm:"size:20"`
    EffectType  string        `gorm:"size:50"`   // buff, damage, heal ç­‰
    EffectValue string        `gorm:"type:text"` // JSON é…ç½®
    Chance      float64       `gorm:"default:1"` // è§¦å‘æ¦‚ç‡
    Description string        `gorm:"size:500"`
}
```

### 5. è£…å¤‡æœåŠ¡ (EquipmentService)
```go
type EquipmentService struct {
    db *gorm.DB
}

// Equip è£…å¤‡ç‰©å“
func (s *EquipmentService) Equip(characterID uint, inventoryItemID uint, slot EquipmentSlot) error {
    // 1. æ£€æŸ¥ç‰©å“æ˜¯å¦å±äºè¯¥è§’è‰²
    // 2. æ£€æŸ¥ç‰©å“æ˜¯å¦å¯è£…å¤‡åˆ°è¯¥æ§½ä½
    // 3. å¦‚æœæ§½ä½å·²æœ‰è£…å¤‡ï¼Œå…ˆå¸ä¸‹
    // 4. è£…å¤‡ç‰©å“
}

// Unequip å¸ä¸‹è£…å¤‡
func (s *EquipmentService) Unequip(characterID uint, slot EquipmentSlot) error

// GetEquippedItems è·å–æ‰€æœ‰å·²è£…å¤‡ç‰©å“
func (s *EquipmentService) GetEquippedItems(characterID uint) ([]CharacterEquipment, error)

// CalculateTotalStats è®¡ç®—è£…å¤‡æ€»å±æ€§åŠ æˆ
func (s *EquipmentService) CalculateTotalStats(characterID uint) (*TotalStats, error) {
    // æ±‡æ€»æ‰€æœ‰è£…å¤‡çš„å±æ€§ï¼ˆå«å¼ºåŒ–åŠ æˆï¼‰
}
```

### 6. å¼ºåŒ–å±æ€§åŠ æˆè®¡ç®—
```go
// æ¯çº§å¼ºåŒ–å¢åŠ çš„å±æ€§ç™¾åˆ†æ¯”
const EnhanceStatBonus = 0.05 // 5%

func (s *EquipmentService) getEnhancedStats(item InventoryItem) ItemEquipmentStats {
    baseStats := item.Item.EquipmentStats
    enhanceMultiplier := 1.0 + float64(item.EnhanceLevel) * EnhanceStatBonus
    
    return ItemEquipmentStats{
        Strength:     int(float64(baseStats.Strength) * enhanceMultiplier),
        Agility:      int(float64(baseStats.Agility) * enhanceMultiplier),
        // ... å…¶ä»–å±æ€§
    }
}
```

### 7. API æ¥å£
| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/characters/:id/equipment | è·å–å·²è£…å¤‡ç‰©å“ |
| POST | /api/characters/:id/equipment/:slot | è£…å¤‡ç‰©å“åˆ°æ§½ä½ |
| DELETE | /api/characters/:id/equipment/:slot | å¸ä¸‹è£…å¤‡ |
| GET | /api/characters/:id/stats | è·å–è§’è‰²æ€»å±æ€§ï¼ˆå«è£…å¤‡åŠ æˆï¼‰ |

### 8. åˆå§‹è£…å¤‡æ•°æ®
```go
var DefaultEquipments = []Item{
    {
        Code: "bronze_sword", Name: "é’é“œå‰‘", Tier: 1,
        Stackable: false, MaxStack: 1,
        EquipmentStats: ItemEquipmentStats{
            Slot: SlotWeapon, AttackPower: 10, Strength: 2,
        },
    },
    {
        Code: "leather_armor", Name: "çš®ç”²", Tier: 1,
        Stackable: false, MaxStack: 1,
        EquipmentStats: ItemEquipmentStats{
            Slot: SlotChest, Defense: 8, Endurance: 3,
        },
    },
    {
        Code: "wool_hat", Name: "ç¾Šæ¯›å¸½", Tier: 1,
        Stackable: false, MaxStack: 1,
        EquipmentStats: ItemEquipmentStats{
            Slot: SlotHelmet, Defense: 3, Intelligence: 2,
        },
    },
}
```

## âœ… éªŒè¯æ£€æŸ¥ç‚¹

å®Œæˆåè¯·éªŒè¯ï¼š
1. [ ] èƒ½è£…å¤‡ç‰©å“åˆ°æ­£ç¡®æ§½ä½
2. [ ] ä¸èƒ½è£…å¤‡åˆ°é”™è¯¯æ§½ä½ï¼ˆå¦‚æ­¦å™¨è£…åˆ°å¤´ç›”ä½ï¼‰
3. [ ] å¸ä¸‹è£…å¤‡åç‰©å“å›åˆ°ä»“åº“
4. [ ] è§’è‰²æ€»å±æ€§æ­£ç¡®è®¡ç®—ï¼ˆåŸºç¡€ + è£…å¤‡åŠ æˆï¼‰
5. [ ] å¼ºåŒ–ç­‰çº§æ­£ç¡®å½±å“è£…å¤‡å±æ€§
6. [ ] è£…å¤‡ç‰¹æ®Šæ•ˆæœé…ç½®æ­£ç¡®å­˜å‚¨

## ğŸ”— ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡ 01ï¼ˆè§’è‰²æ¨¡å‹ï¼‰
- ä¾èµ–ï¼šä»»åŠ¡ 02ï¼ˆç‰©å“ç³»ç»Ÿï¼‰
